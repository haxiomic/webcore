<!DOCTYPE html>

<html>
	<head>
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
		<meta charset="utf-8">
		<style>
			body {
				margin: 0;
				overflow: hidden;
				position: fixed;
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<script src="app.js"></script>
		<script>
			let pixelRatio = window.devicePixelRatio != null ? window.devicePixelRatio : 1;

			// create a canvas to provide the OpenGL context
			let canvas = document.createElement('canvas');
			document.body.appendChild(canvas);

			canvas.style.display = 'block';

			// disable default touch actions, this helps disable view dragging on touch devices
			canvas.style.touchAction = 'none';
			canvas.setAttribute('touch-action', 'none');
			
			// resize canvas with window
			function canvasFillWindow() {
				// - html px units do not match the screen's native resolution
				// - the ratio between html px units and the screen's pixels is stored in devicePixelRatio
				// - the canvas width / height attribute set the size of the drawing buffer
				// - to create a canvas that draws at the screen's native resolution we set 
				canvas.width = Math.round(window.innerWidth * pixelRatio);
				canvas.height = Math.round(window.innerHeight * pixelRatio);
				canvas.style.width = "100%";
				canvas.style.height = "100%";
			}

			canvasFillWindow();
			window.addEventListener('resize', canvasFillWindow);

			// get the webgl context
			let webglContextAttributes = {
				antialias: true,
				stencil: false,
				depth: false,
				alpha: false,
				premultipliedAlpha: false,
				preserveDrawingBuffer: false,
				powerPreference: 'high-performance',
				desynchronized: true,
			}

			let gl = canvas.getContext('webgl', webglContextAttributes);
			
			// add canvas gl context listeners to encourage powerPreference to be respected
			canvas.addEventListener('webglcontextlost', function() { window.location.reload() } );
			canvas.addEventListener('webglcontextrestored', function() { console.log('webglcontextrestored') });

			// initialize our minimal-gl example, supplying it with the OpenGL context
			let demoApp = new DemoApp(gl);

			// native browser frame-loop
			function frameLoop(t_ms) {
				// tell app to draw a frame 
				demoApp.drawFrame();

				window.requestAnimationFrame(frameLoop);
			}

			// start the frame loop
			frameLoop(window.performance.now());
		</script>
	</body>
</html>